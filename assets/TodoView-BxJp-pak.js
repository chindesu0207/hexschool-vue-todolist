import{g as N,r,u as O,h as F,i as K,c as i,a as e,j as _,e as B,t as x,k as L,w as $,v as b,n as w,F as P,l as j,o as u,m as q}from"./index-ClRWuhra.js";import{a as v,S as f}from"./sweetalert2.esm.all-DYEfS7jK.js";const R="https://todolist-api.hexschool.io",G=N("auth",()=>{const g=r(!1),h=r(""),l=r("");async function a(){const n=document.cookie.replace(/(?:(?:^|.*;\s*)todoToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");if(n)try{h.value=n;const m=await v.get(`${R}/users/checkout`,{headers:{Authorization:h.value}});l.value=m.data.nickname,g.value=!0}catch(m){g.value=!1,console.log(m)}}return{authCheck:a,isAuth:g,token:h,nickname:l}}),H={id:"todoListPage",class:"bg-half"},I={key:0},J={class:"todo_sm"},Q={href:"#"},W={class:"conatiner todoListPage vhContainer"},X={class:"todoList_Content"},Y={class:"inputBox"},Z={class:"todoList_list"},tt={class:"todoList_tab"},et={class:"todoList_items"},ot={key:0,class:"noTodo"},st={class:"todoList_item"},nt={key:0,class:"todoList_label"},lt={key:1,class:"todoList_label"},at=["onClick","onUpdate:modelValue"],it={key:2,class:"todoList_btn"},ut=["onClick"],ct={key:3,class:"todoList_btn"},rt=["onClick"],dt=["onClick"],vt={class:"todoList_statistics"},k="https://todolist-api.hexschool.io",ft={__name:"TodoView",setup(g){const h=O(),l=G(),a=r("all"),n=r([]),m=F(()=>{let o=[];for(let t=0;t<n.value.length;t++)(a.value=="all"||a.value=="todo"&&!n.value[t].status||a.value=="done"&&n.value[t].status)&&o.push(n.value[t]);return o}),A=()=>{document.cookie="todoToken=true; max-age=0;",l.token="",l.nickname="",l.isAuth=!1,n.value=[],h.push("/")},C=r({content:""}),T=async o=>{if(o!="")try{const t=await v.post(`${k}/todos/`,{content:o},{headers:{Authorization:l.token}});C.value={},p()}catch(t){console.log(t)}else f.fire({title:"請填入待辦內容",icon:"error",confirmButtonText:"OK",timer:2e3})},y=r(0),p=async()=>{try{const o=await v.get(`${k}/todos/`,{headers:{Authorization:l.token}});n.value=o.data.data,y.value=0;for(let t=0;t<n.value.length;t++)n.value[t].status&&y.value++}catch(o){console.log(o)}},c=r({content:""}),z=o=>{c.value={...o}},V=()=>{c.value={}},S=async o=>{try{const t=await v.put(`${k}/todos/${o}`,c.value,{headers:{Authorization:l.token}});c.value={},p()}catch(t){console.log(t)}},D=o=>{f.fire({title:"確認要刪除嗎?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是",cancelButtonText:"否"}).then(async t=>{if(t.isConfirmed)try{const s=await v.delete(`${k}/todos/${o}`,{headers:{Authorization:l.token}});p().then(()=>{f.fire({title:"Deleted!",text:"成功刪除",icon:"success"})})}catch(s){console.log(s)}})},M=async o=>{try{const t=await v.patch(`${k}/todos/${o}/toggle`,{},{headers:{Authorization:l.token}});p()}catch(t){console.log(t)}};K(async()=>{await l.authCheck(),l.isAuth?p():(f.fire({title:"未登入",icon:"error",text:"即將導向登入頁面",confirmButtonText:"OK",timer:2e3}),setTimeout(()=>{h.push("/login")},2e3))});const U=()=>{const o=["新增待辦事項","切換待辦事項狀態","修改待辦事項","移除待辦事項"];for(let t=0;t<o.length;t++)T(o[t])},E=()=>{f.fire({title:"確認要全部刪除嗎?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是",cancelButtonText:"否"}).then(async o=>{if(o.isConfirmed){for(let t=0;t<n.value.length;t++)await v.delete(`${k}/todos/${n.value[t].id}`,{headers:{Authorization:l.token}});p().then(()=>{f.fire({title:"Deleted!",text:"已刪除所有待辦",icon:"success"})})}})};return(o,t)=>(u(),i("div",H,[e("input",{type:"button",class:"oneButton",onClick:_(U,["prevent"]),value:"一鍵加入"}),e("input",{type:"button",class:"deleteAll",onClick:_(E,["prevent"]),value:"全部刪除"}),e("nav",null,[t[6]||(t[6]=e("a",{href:"#"},[e("img",{class:"logoImg_nav",src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/logo.png",alt:""})],-1)),B(l).isAuth?(u(),i("ul",I,[e("li",J,[e("a",Q,[e("span",null,x(B(l).nickname)+"的待辦",1)])]),e("li",null,[e("a",{onClick:A},"登出")])])):L("",!0)]),e("div",W,[e("div",X,[e("div",Y,[$(e("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":t[0]||(t[0]=s=>C.value.content=s)},null,512),[[b,C.value.content]]),e("a",{onClick:t[1]||(t[1]=s=>T(C.value.content))},t[7]||(t[7]=[e("i",{class:"fa fa-plus"},null,-1)]))]),e("div",Z,[e("ul",tt,[e("li",null,[e("a",{onClick:t[2]||(t[2]=_(s=>a.value="all",["prevent"])),class:w([a.value=="all"?"active":""])},"全部",2)]),e("li",null,[e("a",{onClick:t[3]||(t[3]=_(s=>a.value="todo",["prevent"])),class:w([a.value=="todo"?"active":""])},"待完成",2)]),e("li",null,[e("a",{onClick:t[4]||(t[4]=_(s=>a.value="done",["prevent"])),class:w([a.value=="done"?"active":""])},"已完成",2)])]),e("div",et,[n.value.length==0?(u(),i("div",ot,t[8]||(t[8]=[e("p",null,"目前尚無待辦事項",-1)]))):L("",!0),e("ul",st,[(u(!0),i(P,null,j(m.value,s=>(u(),i("li",{key:s.id},[s.id===c.value.id?(u(),i("label",nt,[$(e("input",{class:"todoList_input_edit",type:"text","onUpdate:modelValue":t[5]||(t[5]=d=>c.value.content=d)},null,512),[[b,c.value.content]])])):(u(),i("label",lt,[$(e("input",{class:"todoList_input",type:"checkbox",value:"true",onClick:d=>M(s.id),"onUpdate:modelValue":d=>s.status=d},null,8,at),[[q,s.status]]),e("span",null,x(s.content),1)])),s.id===c.value.id?(u(),i("div",it,[e("a",{onClick:d=>S(s.id)},t[9]||(t[9]=[e("i",{class:"fa-regular fa-circle-check fa-2xl"},null,-1)]),8,ut),e("a",{onClick:V},t[10]||(t[10]=[e("i",{class:"fa-regular fa-circle-xmark fa-2xl"},null,-1)]))])):(u(),i("div",ct,[e("a",{onClick:d=>z(s)},t[11]||(t[11]=[e("i",{class:"fa-solid fa-pen-to-square fa-2xl"},null,-1)]),8,rt),e("a",{onClick:d=>D(s.id)},t[12]||(t[12]=[e("i",{class:"fa-solid fa-trash-can fa-2xl"},null,-1)]),8,dt)]))]))),128))]),e("div",vt,[e("p",null,x(n.value.length-y.value)+" 個待完成項目",1)])])])])])]))}};export{ft as default};
