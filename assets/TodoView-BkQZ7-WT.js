import{g as K,r as f,u as F,h as P,i as j,j as q,c as d,b as R,a as e,k as g,e as B,t as y,l as b,w as T,v as A,n as $,F as z,m as G,o as v,p as H}from"./index-CchHn25E.js";import{a as p,S as h}from"./sweetalert2.esm.all-DYEfS7jK.js";const J="https://todolist-api.hexschool.io",Q=K("auth",()=>{const _=f(!1),m=f(""),l=f("");async function i(){const a=document.cookie.replace(/(?:(?:^|.*;\s*)todoToken\s*\=\s*([^;]*).*$)|^.*$/,"$1");if(a)try{m.value=a;const n=await p.get(`${J}/users/checkout`,{headers:{Authorization:m.value}});l.value=n.data.nickname,_.value=!0}catch(n){_.value=!1,console.log(n)}}return{authCheck:i,isAuth:_,token:m,nickname:l}}),W={id:"todoListPage",class:"bg-half"},X={key:0},Y={class:"todo_sm"},Z={href:"#"},tt={class:"conatiner todoListPage vhContainer"},et={class:"todoList_Content"},ot={class:"inputBox"},nt={class:"todoList_list"},st={class:"todoList_tab"},lt={class:"todoList_items"},at={key:0,class:"noTodo"},it={class:"todoList_item"},ut={key:0,class:"todoList_label"},ct={key:1,class:"todoList_label"},rt=["onClick","onUpdate:modelValue"],dt={key:2,class:"todoList_btn"},vt=["onClick"],ft={key:3,class:"todoList_btn"},ht=["onClick"],pt=["onClick"],mt={class:"todoList_statistics"},k="https://todolist-api.hexschool.io",_t={__name:"TodoView",setup(_){const m=F(),l=Q(),i=f(!1),a=f("all"),n=f([]),V=P(()=>{let o=[];for(let t=0;t<n.value.length;t++)(a.value=="all"||a.value=="todo"&&!n.value[t].status||a.value=="done"&&n.value[t].status)&&o.push(n.value[t]);return o}),S=()=>{document.cookie="todoToken=true; max-age=0;",l.token="",l.nickname="",l.isAuth=!1,n.value=[],m.push("/")},x=f({content:""}),w=async o=>{if(o.trim()!=""){i.value=!0;try{const t=await p.post(`${k}/todos/`,{content:o.trim()},{headers:{Authorization:l.token}});n.value.push({id:t.data.newTodo.id,content:t.data.newTodo.content,status:!1}),x.value.content="",setTimeout(()=>{i.value=!1},500)}catch(t){console.log(t)}}else h.fire({title:"請填入待辦內容",icon:"error",confirmButtonText:"OK",timer:2e3})},C=f(0),L=async()=>{try{const o=await p.get(`${k}/todos/`,{headers:{Authorization:l.token}});n.value=o.data.data,C.value=0;for(let t=0;t<n.value.length;t++)n.value[t].status&&C.value++}catch(o){console.log(o)}},u=f({content:""}),D=o=>{u.value={...o}},M=()=>{u.value={}},N=async o=>{if(u.value.content!=o.content)try{const t=await p.put(`${k}/todos/${o.id}`,u.value,{headers:{Authorization:l.token}}),c=n.value.findIndex(s=>s.id==o.id);n.value[c].content=u.value.content,u.value={}}catch(t){console.log(t)}else h.fire({title:"待辦內容未更新",icon:"error",confirmButtonText:"OK",timer:2e3})},O=o=>{h.fire({title:"確認要刪除嗎?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是",cancelButtonText:"否"}).then(async t=>{if(t.isConfirmed){i.value=!0;try{const c=await p.delete(`${k}/todos/${o}`,{headers:{Authorization:l.token}}).then(()=>{h.fire({title:"Deleted!",text:"成功刪除",icon:"success"})}),s=n.value.findIndex(r=>r.id==o);n.value.splice(s,s==0?1:s),i.value=!1}catch(c){console.log(c)}}})},U=async o=>{try{const t=await p.patch(`${k}/todos/${o}/toggle`,{},{headers:{Authorization:l.token}})}catch(t){console.log(t);const c=n.value.findIndex(s=>s.id==o);n.value[c].status=!n.value[c].status}};j(async()=>{await l.authCheck(),l.isAuth?L():(h.fire({title:"未登入",icon:"error",text:"即將導向登入頁面",confirmButtonText:"OK",timer:2e3}),setTimeout(()=>{m.push("/login")},2e3))});const E=()=>{i.value=!0;const o=["新增待辦事項","切換待辦事項狀態","修改待辦事項","移除待辦事項"];for(let t=0;t<o.length;t++)w(o[t]);setTimeout(()=>{i.value=!1},500)},I=()=>{h.fire({title:"確認要全部刪除嗎?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"是",cancelButtonText:"否"}).then(async o=>{if(i.value=!0,o.isConfirmed){for(let t=0;t<n.value.length;t++)await p.delete(`${k}/todos/${n.value[t].id}`,{headers:{Authorization:l.token}});L().then(()=>{h.fire({title:"Deleted!",text:"已刪除所有待辦",icon:"success"}),i.value=!1})}})};return(o,t)=>{const c=q("Loading");return v(),d(z,null,[R(c,{active:i.value},null,8,["active"]),e("div",W,[e("input",{type:"button",class:"oneButton",onClick:g(E,["prevent"]),value:"一鍵加入"}),e("input",{type:"button",class:"deleteAll",onClick:g(I,["prevent"]),value:"全部刪除"}),e("nav",null,[t[6]||(t[6]=e("a",{href:"#"},[e("img",{class:"logoImg_nav",src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/logo.png",alt:""})],-1)),B(l).isAuth?(v(),d("ul",X,[e("li",Y,[e("a",Z,[e("span",null,y(B(l).nickname)+"的待辦",1)])]),e("li",null,[e("a",{onClick:S},"登出")])])):b("",!0)]),e("div",tt,[e("div",et,[e("div",ot,[T(e("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":t[0]||(t[0]=s=>x.value.content=s)},null,512),[[A,x.value.content]]),e("a",{onClick:t[1]||(t[1]=s=>w(x.value.content))},t[7]||(t[7]=[e("i",{class:"fa fa-plus"},null,-1)]))]),e("div",nt,[e("ul",st,[e("li",null,[e("a",{onClick:t[2]||(t[2]=g(s=>a.value="all",["prevent"])),class:$([a.value=="all"?"active":""])},"全部",2)]),e("li",null,[e("a",{onClick:t[3]||(t[3]=g(s=>a.value="todo",["prevent"])),class:$([a.value=="todo"?"active":""])},"待完成",2)]),e("li",null,[e("a",{onClick:t[4]||(t[4]=g(s=>a.value="done",["prevent"])),class:$([a.value=="done"?"active":""])},"已完成",2)])]),e("div",lt,[n.value.length==0?(v(),d("div",at,t[8]||(t[8]=[e("p",null,"目前尚無待辦事項",-1)]))):b("",!0),e("ul",it,[(v(!0),d(z,null,G(V.value,s=>(v(),d("li",{key:s.id},[s.id===u.value.id?(v(),d("label",ut,[T(e("input",{class:"todoList_input_edit",type:"text","onUpdate:modelValue":t[5]||(t[5]=r=>u.value.content=r)},null,512),[[A,u.value.content]])])):(v(),d("label",ct,[T(e("input",{class:"todoList_input",type:"checkbox",value:"true",onClick:r=>U(s.id),"onUpdate:modelValue":r=>s.status=r},null,8,rt),[[H,s.status]]),e("span",null,y(s.content),1)])),s.id===u.value.id?(v(),d("div",dt,[e("a",{onClick:r=>N(s)},t[9]||(t[9]=[e("i",{class:"fa-regular fa-circle-check fa-2xl"},null,-1)]),8,vt),e("a",{onClick:M},t[10]||(t[10]=[e("i",{class:"fa-regular fa-circle-xmark fa-2xl"},null,-1)]))])):(v(),d("div",ft,[e("a",{onClick:r=>D(s)},t[11]||(t[11]=[e("i",{class:"fa-solid fa-pen-to-square fa-2xl"},null,-1)]),8,ht),e("a",{onClick:r=>O(s.id)},t[12]||(t[12]=[e("i",{class:"fa-solid fa-trash-can fa-2xl"},null,-1)]),8,pt)]))]))),128))]),e("div",mt,[e("p",null,y(n.value.length-C.value)+" 個待完成項目",1)])])])])])])],64)}}};export{_t as default};
